!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("os"),require("fs"),require("path")):"function"==typeof define&&define.amd?define(["os","fs","path"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).kindleClipping=e(t.os,t.fs,t.path)}(this,(function(t,e,n){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=o(t),r=o(e),s=o(n);const u=/(Highlight|标注)/,l=/(Note|笔记)/,c=/(Added on|添加于)/;function a(t){var e,n;const o=/[0-9]+/;let{pageTypeText:i,locationText:r,dateText:s}=function(t){const e=t.split("|");if(2===e.length){const[t,n]=e;return{pageTypeText:t,locationText:"",dateText:n}}{let[t,n,o]=e;return{pageTypeText:t,locationText:n,dateText:o}}}(t),a="Unknown";u.test(i)&&(a="Highlight"),l.test(i)&&(a="Note");return{type:a,page:(null===(e=i.match(o))||void 0===e?void 0:e[0])||"",location:(null===(n=r.match(o))||void 0===n?void 0:n[0])||"",date:s.replace(c,"").trim()}}function p(t){const[e,n,o,i]=t;return{bookName:e,content:i,...a(n)}}function d(t){const e=t.split("\n").slice(0,-1),n=[];for(;e.length>0;)n.push(p(e.splice(0,5)));return n}const f=i.default.type();function h(){if("Windows_NT"===f)return function(){for(let t=1;t<9;t++){const e=String.fromCharCode("C".charCodeAt(0)+t),n=s.default.resolve(`${e}:/documents/My Clippings.txt`);if(r.default.existsSync(n))return n}return"path"}();if("Darwin"===f)return s.default.resolve(__dirname,"/Volumes/Kindle/documents/My Clippings.txt");throw new Error("unSupport os")}function g(t){if(!r.default.existsSync(t))throw new Error(`${t} not exist, please make sure the kindle device is connected properly!`);return r.default.readFileSync(t).toString("utf8")}class y{constructor(t=""){this.clippingPath=t?s.default.resolve(__dirname,t):h()}getJson(){return d(g(this.clippingPath))}getMergedJson(){return function(t){const e=[];for(let n=0;n<t.length;n++){const o=t[n],i=t[n+1];i&&o.type!==i.type&&o.date.toString()===i.date.toString()?(e.push({...i,type:"Note",note:o.content}),n++):"Highlight"===o.type&&e.push(o)}return e}(d(g(this.clippingPath)))}}return function(t){return new y(t)}}));
