!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fs"),require("os"),require("path")):"function"==typeof define&&define.amd?define(["fs","os","path"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).kindleClipping=e(t.fs,t.os,t.path)}(this,(function(t,e,n){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=o(t),r=o(e),l=o(n);const s=/(Highlight|标注)/,u=/(Note|笔记)/,c=/(Added on|添加于)/;function a(t){var e,n;const o=/[0-9]+/;let{pageTypeText:i,locationText:r,dateText:l}=function(t){const e=t.split("|");if(2===e.length){const[t,n]=e;return{pageTypeText:t,locationText:"",dateText:n}}{let[t,n,o]=e;return{pageTypeText:t,locationText:n,dateText:o}}}(t),a="Unknown";s.test(i)&&(a="Highlight"),u.test(i)&&(a="Note");return{type:a,page:(null===(e=i.match(o))||void 0===e?void 0:e[0])||"",location:(null===(n=r.match(o))||void 0===n?void 0:n[0])||"",date:l.replace(c,"").trim()}}function d(t){const[e,n,o,i]=t;return{bookName:e,content:i,...a(n)}}function p(t){if(!i.default.existsSync(t))throw new Error(`${t} not exist!`);const e=i.default.readFileSync(t).toString("utf8").split("\n").slice(0,-1),n=[];for(;e.length>0;)n.push(d(e.splice(0,5)));return n}const f=r.default.type();function g(){return"Windows_NT"===f?l.default.resolve(__dirname,"/window"):"Darwin"===f?l.default.resolve(__dirname,"/Volumes/Kindle/documents/My Clippings.txt"):""}class h{constructor(t=""){this.clippingPath=t&&l.default.resolve(__dirname,t)}getJson(){return p(this.clippingPath||g())}getMergedJson(){return function(t){const e=[];for(let n=0;n<t.length;n++){const o=t[n],i=t[n+1];i&&o.type!==i.type&&o.date.toString()===i.date.toString()?(e.push({...i,type:"Note",note:o.content}),n++):"Highlight"===o.type&&e.push(o)}return e}(p(this.clippingPath||g()))}}return console.log(new h("../test/lib/clippings.txt").getMergedJson()),h}));
